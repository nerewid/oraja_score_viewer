<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>oraja_score_viewer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1:wght@400;500;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script>
        // github.ioã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒãƒªãƒã‚¸ãƒˆãƒªã®ãƒˆãƒƒãƒ—ã«ãªã‚‰ãªã„å•é¡Œã‚’è§£æ¶ˆã™ã‚‹
        const pathSegments = window.location.pathname.split('/').filter(segment => segment !== '');
        // HTMLãƒ•ã‚¡ã‚¤ãƒ«åã‚’é™¤å¤–ã—ã¦ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ã‚’å–å¾—
        const filteredSegments = pathSegments.filter(segment => !segment.endsWith('.html'));
        const repoName = filteredSegments.length > 0 ? '/' + filteredSegments[0] + '/' : '/';
        const baseTag = document.createElement('base');
        baseTag.href = repoName;
        console.log('Base path:', repoName);
        document.head.appendChild(baseTag);
    </script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="cal-heatmap.css">
</head>
<body>
    <div class="lang-switcher">
        <button id="lang-ja" class="lang-btn active">JP</button>
        <button id="lang-en" class="lang-btn">EN</button>
    </div>
    <h1>oraja_score_viewer</h1>
    <div id="upload-area">
        <h3><span data-i18n="app.description">beatorajaã®ãƒ—ãƒ¬ã‚¤å±¥æ­´ã‚’æ—¥åˆ¥ã«åˆ†ã‹ã‚Šã‚„ã™ãè¡¨ç¤ºã—ã¾ã™ã€‚</span><br>
        <span data-i18n="app.table_update_date">é›£æ˜“åº¦è¡¨æƒ…å ±æ›´æ–°æ—¥ï¼š</span>2025/12/21</h3>
        <hr>
        <h3 data-i18n="upload.howto">åˆ©ç”¨æ–¹æ³•</h3>
        <span data-i18n="upload.instruction">beatorajaãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­ã«ã‚ã‚‹dbãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</span><br>
        <span data-i18n="upload.score_location" data-i18n-html>score.db, scorelog.dbã¯ <span style="font-weight: bold;">beatoraja0.x.x/player/(playerName)</span> ãƒ•ã‚©ãƒ«ãƒ€ã«</span><br>
        <span data-i18n="upload.songdata_location" data-i18n-html>songdata.dbã¯ <span style="font-weight: bold;">beatoraja0.x.x/</span> ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚Šã¾ã™ã€‚</span><br>
        <div class="upload-row">
            <button id="uploadscoredb" data-i18n="button.load_score">score.db ã‚’èª­ã¿è¾¼ã‚€</button>
            <input type="file" id="fileInputscore" accept=".db" style="display: none;">
            <div id="fileinfoscore"></div>
            <div id="message-score" class="message"></div>
        </div>

        <div class="upload-row">
            <button id="uploadscorelogdb" data-i18n="button.load_scorelog">scorelog.db ã‚’èª­ã¿è¾¼ã‚€</button>
            <input type="file" id="fileInputscorelog" accept=".db" style="display: none;">
            <div id="fileinfoscorelog"></div>
            <div id="message-scorelog" class="message"></div>
        </div>

        <div class="upload-row">
            <button id="uploadsongdatadb" data-i18n="button.load_songdata">songdata.db ã‚’èª­ã¿è¾¼ã‚€</button>
            <input type="file" id="fileInputsongdata" accept=".db" style="display: none;">
            <div id="fileinfosongdata"></div>
            <div id="message-songdata" class="message"></div>
        </div>

        <button id="processData" disabled data-i18n="button.process">ãƒ‡ãƒ¼ã‚¿å‡¦ç†é–‹å§‹</button>

        <div id="loading-display" class="loading-container hidden">
            <div class="loading-spinner"></div>
            <h3 id="loading-title" data-i18n="loading.processing">å‡¦ç†ä¸­...</h3>
            <p id="loading-message" data-i18n="loading.db_loading">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™</p>
            <div class="loading-progress-bar">
                <div id="loading-progress" class="loading-progress-fill"></div>
            </div>
        </div>

        <div id="error-display" class="error-container hidden">
            <h3>âŒ <span data-i18n="error.title">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</span></h3>
            <p id="error-message"></p>
            <details id="error-details">
                <summary data-i18n="error.details">è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º</summary>
                <pre id="error-stack"></pre>
            </details>
            <button id="error-close" class="error-close-btn" data-i18n="button.close">é–‰ã˜ã‚‹</button>
        </div>

        <hr>
        <span data-i18n="link.details">æœ¬ãƒ„ãƒ¼ãƒ«ã®è©³ç´°ã€å¯¾å¿œã—ã¦ã„ã‚‹é›£æ˜“åº¦è¡¨ã«ã¤ã„ã¦ã¯</span><a href="https://github.com/nerewid/oraja_score_viewer" data-i18n="link.here">ã“ã¡ã‚‰ã€‚</a><br>
        <a href="table_viewer.html" style="color: #4db5ff; font-size: 1.1em; margin-top: 10px; display: inline-block;">
            ğŸ“Š <span data-i18n="link.table_viewer">é›£æ˜“åº¦è¡¨ã‚’é–²è¦§ã™ã‚‹</span>
        </a>
    </div>

    <div class="tab" id="tab-buttons">
        <button class="tablinks active" data-tab="tabA">Score Log Viewer</button>
        <button class="tablinks" data-tab="tabB">Lamp viewer</button>
    </div>

    <div id="tabA" class="tabcontent">
        <div id="cal-heatmap-notes-pre"></div>
        <div id="cal-heatmap-notes"></div>
        <div id="cal-heatmap-progress-pre"></div>
        <div id="cal-heatmap-progress"></div>
        <div id="results-area"></div>
    </div>

    <div id="tabB" class="tabcontent">
        <div class="horizontal-container">
            <select id="difficulty-table-select"></select>
            <div style="display: flex; gap: 15px; align-items: center;">
                <label style="cursor: pointer; user-select: none;">
                    <input type="radio" name="ln-mode" value="0" checked style="cursor: pointer; margin-right: 5px;"> LN
                </label>
                <label style="cursor: pointer; user-select: none;">
                    <input type="radio" name="ln-mode" value="1" style="cursor: pointer; margin-right: 5px;"> CN
                </label>
                <label style="cursor: pointer; user-select: none;">
                    <input type="radio" name="ln-mode" value="2" style="cursor: pointer; margin-right: 5px;"> HCN
                </label>
            </div>
        </div>
        <div id="lamp-legend" class="lamp-legend">
            <div class="legend-item"><span class="legend-color" style="background: rgba(255, 215, 0, 0.8);"></span>Max</div>
            <div class="legend-item"><span class="legend-color" style="background: rgba(173, 255, 47, 0.8);"></span>Perfect</div>
            <div class="legend-item"><span class="legend-color" style="background: rgba(0, 255, 255, 0.8);"></span>FullCombo</div>
            <div class="legend-item"><span class="legend-color" style="background: rgba(255, 165, 0, 0.8);"></span>ExHard</div>
            <div class="legend-item"><span class="legend-color" style="background: rgba(192, 0, 0, 0.8);"></span>Hard</div>
            <div class="legend-item"><span class="legend-color" style="background: rgba(135, 206, 235, 0.8);"></span>Normal</div>
            <div class="legend-item"><span class="legend-color" style="background: rgba(0, 128, 0, 0.8);"></span>Easy</div>
            <div class="legend-item"><span class="legend-color" style="background: rgba(255, 192, 203, 0.8);"></span>LightAssist</div>
            <div class="legend-item"><span class="legend-color" style="background: rgba(128, 0, 128, 0.8);"></span>AssistEasy</div>
            <div class="legend-item"><span class="legend-color" style="background: rgba(128, 0, 0, 0.8);"></span>Failed</div>
            <div class="legend-item"><span class="legend-color" style="background: rgba(32, 32, 32, 0.8);"></span>NoPlay</div>
        </div>
        <div id="lamp-graph-area"></div>
        <div id="song-list-area"></div>
    </div>

    <script src="./js/lib/sql-wasm.js"></script>
    <script src="./js/lib/nunjucks.min.js"></script>
    <script type="text/javascript" src="./js/lib/d3.v7.min.js"></script>
    <script src="https://unpkg.com/cal-heatmap/dist/cal-heatmap.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/cal-heatmap/dist/plugins/Tooltip.min.js"></script>
    <script src="./js/lib/FileSaver.min.js"></script>

    <script type="module" src="./js/lang_switcher.js"></script>
    <script type="module" src="./js/db_uploader.js"></script>
    <script type="module" src="./js/score_change_to_json.js"></script>
    <script type="module" src="./js/json_creator.js"></script>
    <script type="module" src="./js/heatmap_generator.js"></script>
    <script type="module" src="./js/lamp_graph_generator.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('.tablinks');
            const tabContents = document.querySelectorAll('.tabcontent');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.dataset.tab;

                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.style.display = 'none');

                    button.classList.add('active');
                    document.getElementById(tabId).style.display = 'block';
                });
            });
        });
    </script>
</body>
</html>